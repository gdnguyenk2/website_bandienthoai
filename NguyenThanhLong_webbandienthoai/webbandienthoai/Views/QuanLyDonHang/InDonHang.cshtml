@using webbandienthoai.Models
@model DonDatHang
@{
    ViewBag.Title = "In đơn hàng";
    Layout = "~/Views/Shared/_Layout_Admin.cshtml";
    var index = 1;
}

<h2>Thông tin đơn hàng<font color="red">@Model.KhachHang.TenKH</font></h2>
<br />
<br />

<div class="table ChiTietDonHang">
    @{ IEnumerable<ChiTietDonDatHang> lstChiTietDH = ViewBag.ctdh as IEnumerable<ChiTietDonDatHang>;}
    <table class="table" id="table">
        <tr >
            <td>
                <table style="width: 100%; margin: 20px 0">
                    <tr><td>Tên khách hàng: <b style="color:red">@Model.KhachHang.TenKH</b></td></tr>
                    <tr>
                        <td>Mã đơn hàng: <b style="color:red">@Model.MaDDH @Html.Hidden("MaDDH", Model.MaDDH)</b></td>
                    </tr>
                    <tr>
                        <td>Ngày Đặt: @Model.NgayDatHang</td>
                    </tr>
                    <tr><td>Ngày Giao Hàng: @Model.NgayGiao</td></tr>
                </table>
            </td>
        </tr>
        @*Thông tin chi tiết đơn hàng*@
        <tr>
            <td>
                <table class="table table-bordered">
                    <tr>
                        <td><b>STT</b></td>
                        <td><b>Sản phẩm</b></td>
                        <td><b>Số lượng đặt</b></td>
                        <td><b>Đơn giá đặt</b></td>
                    </tr>
                    @{ decimal thanhtien = 0;}
                    @foreach (var item in lstChiTietDH)
                    {
                        <tr>
                            <td>@index</td>
                            <td>@item.SanPham.TenSP</td>
                            <td>@item.SoLuong</td>
                            <td>@item.DonGia.ToString("#,##") đ</td>
                            @{thanhtien += item.SoLuong * item.DonGia;}
                        </tr>
                        index++;
                        
                    }
                    <tr>
                        <td align="right" colspan="4">Tổng số lượng: @Model.ChiTietDonDatHangs.Sum(n => n.SoLuong)</td>
                    </tr>
                    <tr>
                        <td align="right" colspan="4">Tổng tiền: @thanhtien.ToString("#,##") đ</td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <table style="width: 100%; margin: 20px 0">
                    <tr>
                        <td>Thông tin người nhận:</td>
                    </tr>
                    <tr>
                        <td><b style="color:red">@Model.KhachHang.TenKH</b></td>
                    </tr>
                    <tr>
                        <td><b style="color:#0094ff">@Model.KhachHang.DiaChi</b></td>
                    </tr>
                    <tr>
                        <td><a style="text-decoration:underline"><b>@Model.KhachHang.Email</b></a></td>
                    </tr>
                    <tr>
                        <td><a style="text-decoration:underline"><b>@Model.KhachHang.SoDienThoai</b></a></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <br /><br />
    @Html.ActionLink("Quay Lại", "DaGiaoDaThanhToan", "QuanLyDonHang", new { @class = "btn btn-success" })
    <input type="button" value="In đơn hàng" id="btnInDonHang" class="btn btn-primary" />
</div>
<script>
    $("#btnInDonHang").click(function () {
        var content = "<table>" + $("#table").html() + "</table>";
        InDonHang(content);
    });

    function InDonHang(content) {
        var printWindow = window.open('', '', 'height=450,width=800');
        printWindow.document.write('<html><head><title>Đơn Hàng</title>');

        // Lấy tất cả các stylesheet hiện tại và thêm vào cửa sổ in
        $('link[rel=stylesheet]').each(function () {
            printWindow.document.write('<link href="' + $(this).attr('href') + '" rel="stylesheet" type="text/css" />');
        });

        printWindow.document.write('</head><body>');
        printWindow.document.write(content);
        printWindow.document.write('</body></html>');

        printWindow.document.close();
        printWindow.print();
    }
</script>

